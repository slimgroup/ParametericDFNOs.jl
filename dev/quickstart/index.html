<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quick Start · ParametricDFNOs.jl</title><meta name="title" content="Quick Start · ParametricDFNOs.jl"/><meta property="og:title" content="Quick Start · ParametricDFNOs.jl"/><meta property="twitter:title" content="Quick Start · ParametricDFNOs.jl"/><meta name="description" content="Documentation for ParametricDFNOs.jl."/><meta property="og:description" content="Documentation for ParametricDFNOs.jl."/><meta property="twitter:description" content="Documentation for ParametricDFNOs.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="ParametricDFNOs.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ParametricDFNOs.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Quick Start</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Model-Setup"><span>Model Setup</span></a></li><li><a class="tocitem" href="#Data-Partitioning"><span>Data Partitioning</span></a></li><li><a class="tocitem" href="#Training-wrapper"><span>Training wrapper</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/simple_2D/">2D Forward and Gradient</a></li><li><a class="tocitem" href="../examples/training_2D/">2D Training</a></li><li><a class="tocitem" href="../examples/simple_3D/">3D Forward and Gradient</a></li><li><a class="tocitem" href="../examples/custom_3D/">3D Custom Dataset</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/DFNO_2D/">2D Time varying</a></li><li><a class="tocitem" href="../api/DFNO_3D/">3D Time varying</a></li><li><a class="tocitem" href="../api/UTILS/">Utilites</a></li></ul></li><li><a class="tocitem" href="../future/">Future Work</a></li><li><a class="tocitem" href="../citation/">Citation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Quick Start</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quick Start</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/slimgroup/ParametricDFNOs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/slimgroup/ParametricDFNOs.jl/blob/master/docs/src/quickstart.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>Add <code>ParametricDFNOs.jl</code> as a dependency to your environment.</p><p>To add, either do:</p><pre><code class="language-julia hljs">julia&gt; ]
(v1.9) add ParametricDFNOs</code></pre><p>OR</p><pre><code class="language-julia hljs">julia&gt; using Pkg
julia&gt; Pkg.activate(&quot;path/to/your/environment&quot;)
julia&gt; Pkg.add(&quot;ParametricDFNOs&quot;)</code></pre><div class="admonition is-info"><header class="admonition-header">Jump right in</header><div class="admonition-body"><p>To get started, you can also try running some <a href="https://github.com/turquoisedragon2926/ParametricDFNOs.jl-Examples">examples</a></p></div></div><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>Make sure to include the right dependency you plan on using in your environment</p><pre><code class="language-julia hljs">using MPI
using CUDA

# If you plan on using the 2D Time varying FNO or 3D FNO.
using ParametricDFNOs.DFNO_2D

# If you plan on using the 3D Time varying FNO or 4D FNO.
using ParametricDFNOs.DFNO_3D</code></pre><p>We also use <code>PyPlot</code>, so you would need to do:</p><pre><code class="language-shell hljs">python3 -m pip install matplotlib</code></pre><h3 id="MPI-setup"><a class="docs-heading-anchor" href="#MPI-setup">MPI setup</a><a id="MPI-setup-1"></a><a class="docs-heading-anchor-permalink" href="#MPI-setup" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">MPI Distribution</header><div class="admonition-body"><p>Make sure you have a functional MPI Distribution set up</p></div></div><p>All code must be wrapped in:</p><pre><code class="language-julia hljs">MPI.Init()

### Code here ###

MPI.Finalize()</code></pre><div class="admonition is-success"><header class="admonition-header">Change to custom use case</header><div class="admonition-body"><p>We show the usage for <code>ParametricDFNOs.DFNO_2D</code> but the extension to the other FNOs should be as simple as changing the number. Please refer to the API for exact differences.</p></div></div><h3 id="GPU-usage"><a class="docs-heading-anchor" href="#GPU-usage">GPU usage</a><a id="GPU-usage-1"></a><a class="docs-heading-anchor-permalink" href="#GPU-usage" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">Default behavior</header><div class="admonition-body"><p>By default, the package will be set to use the GPU based the whether the <code>DFNO_2D_GPU</code> flag was set during compile time of the package</p></div></div><p>You can set the GPU flag by using:</p><pre><code class="language-shell hljs">export DFNO_2D_GPU=1</code></pre><p>and </p><pre><code class="language-julia hljs">global gpu_flag = parse(Bool, get(ENV, &quot;DFNO_2D_GPU&quot;, &quot;0&quot;))
DFNO_2D.set_gpu_flag(gpu_flag)</code></pre><div class="admonition is-warning"><header class="admonition-header">Binding GPUs</header><div class="admonition-body"><p>If you wish to run on multiple GPUs, make sure the GPUs are binded to different tasks. The approach we choose in our examples is to unbind our GPUs on request and assign manually:</p><pre><code class="language-julia hljs">using CUDA

CUDA.device!(rank % 4)</code></pre><p>which might be different if you have more or less than 4 GPUs per node.</p></div></div><h2 id="Model-Setup"><a class="docs-heading-anchor" href="#Model-Setup">Model Setup</a><a id="Model-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Setup" title="Permalink"></a></h2><p>Define a <a href="../api/DFNO_2D/#2D-Model">2D Model</a> configuration:</p><pre><code class="language-julia hljs">modelConfig = DFNO_2D.ModelConfig(nx=20, ny=20, nt=50, mx=4, my=4, mt=4, nblocks=4, partition=partition, dtype=Float32)</code></pre><p>Define some random inputs to operate on:</p><pre><code class="language-julia hljs">input_size = (modelConfig.nc_in * modelConfig.nx * modelConfig.ny * modelConfig.nt) ÷ prod(partition)
output_size = input_size * modelConfig.nc_out ÷ modelConfig.nc_in

x = rand(modelConfig.dtype, input_size, 1)
y = rand(modelConfig.dtype, output_size, 1)</code></pre><h3 id="Initializing-model"><a class="docs-heading-anchor" href="#Initializing-model">Initializing model</a><a id="Initializing-model-1"></a><a class="docs-heading-anchor-permalink" href="#Initializing-model" title="Permalink"></a></h3><pre><code class="language-julia hljs">model = DFNO_2D.Model(modelConfig)
θ = DFNO_2D.initModel(model)</code></pre><h3 id="Forward-and-backward-pass"><a class="docs-heading-anchor" href="#Forward-and-backward-pass">Forward and backward pass</a><a id="Forward-and-backward-pass-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-and-backward-pass" title="Permalink"></a></h3><p>See <a href="../examples/simple_2D/#Simple-2D-forward-and-gradient-pass">Simple 2D forward and gradient pass</a> for a full example.</p><pre><code class="language-julia hljs">DFNO_2D.forward(model, θ, x)</code></pre><div class="admonition is-info"><header class="admonition-header">Distributed Loss Function</header><div class="admonition-body"><p>We provide a distributed relative L2 loss but most distributed loss functions should be straight-forward to build with <a href="https://github.com/slimgroup/ParametricOperators.jl"><code>ParametricOperators.jl</code></a></p></div></div><p>To compute gradient:</p><pre><code class="language-julia hljs">using Zygote
using ParametricDFNOs.UTILS

gradient(params -&gt; loss_helper(UTILS.dist_loss(DFNO_2D.forward(model, params, x), y)), θ)[1]</code></pre><h2 id="Data-Partitioning"><a class="docs-heading-anchor" href="#Data-Partitioning">Data Partitioning</a><a id="Data-Partitioning-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Partitioning" title="Permalink"></a></h2><p>We have a <a href="../api/DFNO_2D/#2D-Data-Loading">2D Data Loading</a> <code>struct</code> to store information about our data, consider <a href="../examples/training_2D/#Training-2D-Time-varying-FNO">Training 2D Time varying FNO</a></p><pre><code class="language-julia hljs">dataConfig = DFNO_2D.DataConfig(modelConfig=modelConfig, 
                                x_key = &quot;perm&quot;,
                                x_file = perm_store_path_jld2,
                                y_key=&quot;conc&quot;,
                                y_file = conc_store_path_jld2)</code></pre><p>Consider the following dimensions:</p><p><code>c, t, x, y, z</code> where</p><pre><code class="nohighlight hljs">x, y, z - Spatial Dimensions
t - Time Dimension
c - Channel Dimension</code></pre><p>Data is considered to be combined along certain dimensions:</p><p><code>ct, xy</code> for <code>DFNO_2D</code></p><p><code>ctx, yz</code> for <code>DFNO_3D</code></p><p>The partition array which is a two dimensional array specifies across how many workers is a given combined dimension split across.</p><p>By default we do:</p><pre><code class="language-julia hljs">comm = MPI.COMM_WORLD
pe_count = MPI.Comm_size(comm)

partition = [1, pe_count]</code></pre><p>The models are implemented to modify the operators according to the specified partition. We suggest you leave this as it is.</p><div class="admonition is-warning"><header class="admonition-header">Running into assertion errors</header><div class="admonition-body"><p>If you run into any assertion errors that the number of workers do not divide the data evenly, please make a github issue</p></div></div><p>We provide a distributed read wrapper which allows you to read data seamlessly.</p><p>Simply implement:</p><pre><code class="language-julia hljs">
# Returns tensor of size (in_channels, size(indices)...)
function dist_read_x_tensor(file_name, key, indices)

# Returns tensor of size (out_channels=1, size(indices)...)
function dist_read_y_tensor(file_name, key, indices)</code></pre><div class="admonition is-info"><header class="admonition-header">in channels</header><div class="admonition-body"><p>The number of <code>in_channels</code> you specify at <a href="#Model-Setup">Model Setup</a> is <code>data_channels + 3</code> for <code>DFNO_2D</code> and  <code>data_channels + 4</code> for <code>DFNO_3D</code>. This is to account for the grid data we include for each of the dimensions in the FNO.</p></div></div><div class="admonition is-warning"><header class="admonition-header">out channels</header><div class="admonition-body"><p>Currently, distributed wrapper only supports reading for the case where out channel is 1. You can implement your own read function or wait for a version update</p></div></div><h3 id="DFNO_2D"><a class="docs-heading-anchor" href="#DFNO_2D"><code>DFNO_2D</code></a><a id="DFNO_2D-1"></a><a class="docs-heading-anchor-permalink" href="#DFNO_2D" title="Permalink"></a></h3><p>Here, <code>indicies</code> for the <code>dist_read_x_tensor</code> represents </p><pre><code class="nohighlight hljs">(x_start:x_end, y_start:y_end, sample_start:sample_end)</code></pre><p>and the <code>indices</code> for the <code>dist_read_y_tensor</code> represents:</p><pre><code class="nohighlight hljs">(x_start:x_end, y_start:y_end, t_start:t_end, sample_start:sample_end)</code></pre><h3 id="DFNO_3D"><a class="docs-heading-anchor" href="#DFNO_3D"><code>DFNO_3D</code></a><a id="DFNO_3D-1"></a><a class="docs-heading-anchor-permalink" href="#DFNO_3D" title="Permalink"></a></h3><p>Here, <code>indicies</code> for the <code>dist_read_x_tensor</code> represents </p><pre><code class="nohighlight hljs">(x_start:x_end, y_start:y_end, z_start:z_end, sample_start:sample_end)</code></pre><p>and the <code>indices</code> for the <code>dist_read_y_tensor</code> represents:</p><pre><code class="nohighlight hljs">(x_start:x_end, y_start:y_end, z_start:z_end, t_start:t_end, sample_start:sample_end)</code></pre><p>Now you can use <code>loadDistData</code> from <a href="../api/DFNO_2D/#2D-Data-Loading">2D Data Loading</a> or <a href="../api/DFNO_3D/#3D-Data-Loading">3D Data Loading</a></p><p>This can also be extended to complex storage regime. Consider the following case:</p><pre><code class="nohighlight hljs">samples/
├── sample1/
│   ├── inputs.jld2
│   └── outputs.jld2
└── sample2/
    ├── inputs.jld2
    └── outputs.jld2</code></pre><p>We can do <a href="../examples/custom_3D/#Custom-3D-Time-varying-FNO">Custom 3D Time varying FNO</a></p><h2 id="Training-wrapper"><a class="docs-heading-anchor" href="#Training-wrapper">Training wrapper</a><a id="Training-wrapper-1"></a><a class="docs-heading-anchor-permalink" href="#Training-wrapper" title="Permalink"></a></h2><p>We also provide a training wrapper to train out the box. See <a href="../examples/training_2D/#Training-2D-Time-varying-FNO">Training 2D Time varying FNO</a> for a full example.</p><p>Define a <a href="../api/DFNO_2D/#2D-Training">2D Training</a> configuration:</p><pre><code class="language-julia hljs">trainConfig = DFNO_2D.TrainConfig(
    epochs=10,
    x_train=x_train,
    y_train=y_train,
    x_valid=x_valid,
    y_valid=y_valid,
    plot_every=1
)</code></pre><p>And train using:</p><pre><code class="language-julia hljs">DFNO_2D.train!(trainConfig, model, θ)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../examples/simple_2D/">2D Forward and Gradient »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Monday 15 April 2024 15:02">Monday 15 April 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
